
<div class="cart-items-section">
  <input type="hidden" name="_method" value="put">
  <input type="hidden" name="make_order" value="">
  {% if cart.items.size > 0 %}
    <form action="{{ cart_url }}" method="post" data-cart-form>
      <div class="cart-items-container">
        <!-- Заголовок корзины -->
        <div class="cart-title-container">
          <h1 class="cart-title">Корзина</h1>
          <span class="cart-items-count"><span class="count-number" data-cart-item-count></span> товара</span>
        </div>
        
        <!-- Контейнер с товарами -->
        <div class="cart-items-wrapper">
          <!-- Левая колонка с товарами -->
          <div class="cart-items-left">
            {% for item in cart.items %}
              {% if item.product.canonical_collection.url contains 'program' %}
                <div class="cart-item cart-item_program" data-product-id="{{ item.product.id }}" data-item-id="{{ item.id }}" data-sss="{{ item.product.canonical_collection.url }}">
                  <div class="item-counter" style="display: none;">
                    <div class="counter" data-quantity>
                      <button
                        type="button"
                        data-quantity-change="-1"
                        class="counter-button button button_size-s is-count-down ">
                        <span class="icon icon-minus"></span>
                      </button>
                      <input
                        type="text"
                        value="{{ item.quantity }}"
                        name="cart[quantity][{{item.id}}]"
                        class="counter-input form-control form-control_size-s" />
                      <button
                        type="button"
                        data-quantity-change="1"
                        class="counter-button button button_size-s is-count-up ">
                        <span class="icon icon-plus"></span>
                      </button>
                    </div>
                  </div>
                  <div class="cart-item-content">
                    <div class="cart-item-main">
                      <div class="cart-item-image" style="background-image: url({{ item.variant.first_image.medium_url }});"></div>
                      
                      <div class="cart-item-details">
                        <div class="cart-item-top">
                          <div class="cart-item-header">
                            <div class="cart-item-info">
                              <h2 class="cart-item-title">{{ item.product.title }}</h2>
                              {% if item.variant.option_values.size %}
                                <div class="cart-item-tags">
                                  {% for option_value in item.variant.option_values %}
                                    <span class="tag">{{ option_value.title }}</span>
                                  {% endfor %}                                          
                                </div>
                              {% endif %}
                            </div>
                            <button class="remove-item-btn js-item-delete" aria-label="Удалить товар" data-item-delete="{{ item.id }}" type="submit">
                              <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                                <path d="M6 6L18 18M6 18L18 6" stroke="#9D9D9D" stroke-width="1.5"/>
                              </svg>
                            </button>
                          </div>
                          
                          <div class="cart-meal-options" data-item-accessories>
                            {% for accessory_line in item.accessory_lines %}
                              <div class="meal-option-item">
                                <span data-item-accessory-value-id="{{ accessory_line.accessory_value_id }}">{{ accessory_line.accessory_value_name }}</span>
                              </div>
                            {% endfor %}
                            <div class="allergen-item">
                              <span>Исключения: TODO</span>
                            </div>
                          </div>
                        </div>
                        
                        <div class="cart-item-toggles">
                          <div class="toggle-item">
                            <div class="toggle-switch">
                              <div class="toggle-circle"></div>
                            </div>
                            <span>Исключить воду</span>
                          </div>
                          <div class="toggle-item">
                            <div class="toggle-switch">
                              <div class="toggle-circle"></div>
                            </div>
                            <span>Убрать приборы</span>
                          </div>
                        </div>
                      </div>
                    </div>
                    
                    <div class="cart-item-bottom">
                      <div class="delivery-info">
                        <div class="delivery-row">
                          <div class="info-icon" data-tooltip="Все дни кроме 18 августа, 19 августа">i</div>
                          <span class="delivery-label" id="delivery-date-label">Доставка:</span>
                          <span class="delivery-value">TODO</span>
                        </div>
                        <div class="delivery-row">
                          <div class="info-icon" data-tooltip="Доставка этого рациона осуществляется каждые 2 часа">i</div>
                          <span class="delivery-label" id="delivery-time-label">Время:</span>
                          <span class="delivery-value">TODO</span>
                        </div>
                      </div>
                      
                      <div class="price-breakdown">
                        <div class="price-row">
                          <span class="price-label">Программа:</span>
                          <span class="price-value">
                            <span class="price-amount">{{ item.variant.price | money }}</span>
                            <span class="price-multiplier"> * {{ item.quantity }} дней = </span>
                            <span class="price-total">{{ item.variant.price | times: item.quantity | money }}</span>
                          </span>
                        </div>

                        {% assign total_accessories_price = 0 %}
                        {% assign accessories_prices = item.accessory_lines | map: 'accessory_value_price' %}
                        {% for price in accessories_prices %}
                          {% assign total_accessories_price = total_accessories_price | plus: price %}
                        {% endfor %}
                        <div class="price-row">
                          <span class="price-label">Допы:</span>
                          <span class="price-value">
                            <span class="price-amount">{{ total_accessories_price | times: item.quantity | money }}</span>
                          </span>
                        </div>
                        <div class="price-row total">
                          <span class="price-label">Итого:</span>
                          <span class="price-value">
                            <span class="price-amount">{{ item.total_price | money }}</span>
                          </span>
                        </div>
                        <div class="mobile-remove-link">
                          <a href="#" class="remove-item-link">Удалить из корзины</a>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              {% else %}
                <div class="cart-item">
                  <div class="cart-item-content">
                      <div class="cart-item-main">
                          <div class="cart-item-image" style="background-image: url({{ item.variant.first_image.medium_url }});"></div>
                          
                          <div class="cart-item-details">
                              <div class="cart-item-top">
                                  <div class="cart-item-header">
                                      <div class="cart-item-info">
                                          <h2 class="cart-item-title">СМУЗИ МОЛОКО МИНДАЛЬНОЕ, КЛУБНИКА, ГРУША, АПЕЛЬСИН</h2>
                                      </div>
                                      <button class="remove-item-btn" aria-label="Удалить товар">
                                          <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                                              <path d="M6 6L18 18M6 18L18 6" stroke="#9D9D9D" stroke-width="1.5"></path>
                                          </svg>
                                      </button>
                                  </div>
                                  
                                  <div class="cart-item-extra-info">
                                      <div class="cart-item-quantity">
                                          <div class="quantity-controls">
                                              <button class="quantity-btn minus">-</button>
                                              <span class="quantity-value">1 шт.</span>
                                              <button class="quantity-btn plus">+</button>
                                          </div>
                                                                              <div class="quantity-price">
                                          <span class="price-total">Итого: <span class="price-amount">700 ₽</span></span>
                                      </div>
                                      </div>
                                      
                                                                      <div class="cart-item-program-info">
                                      <div class="program-badge with-icon">
                                          <span>Добавить в программу</span>
                                          <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                                              <path d="M4 6L8 10L12 6" stroke="#9D9D9D" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>
                                          </svg>
                                          <div class="program-dropdown">
                                              <div class="program-list">
                                                  <div class="program-item" data-program="premium">ПРЕМИУМ</div>
                                                  <div class="program-item" data-program="base">БАЗА</div>
                                                  <div class="program-item" data-program="start">СТАРТ</div>
                                                  <div class="program-item" data-program="sport">СПОРТ</div>
                                                  <div class="program-item" data-program="detox">ДЕТОКС</div>
                                                  <div class="program-item" data-program="perezagruzka">ПЕРЕЗАГРУЗКА</div>
                                              </div>
                                          </div>
                                      </div>
                                      <div class="program-note">
                                          <div class="info-icon" data-tooltip="Добавьте это блюдо из меню в свою программу, чтобы получать его вместе с выбранным рационом" style="--tooltip-left: 50%; --tooltip-transform: translateX(-50%);">i</div>
                                          <span>Добавьте это блюдо из меню в свою программу, чтобы получать его вместе с выбранным рационом</span>
                                      </div>
                                  </div>
                                  </div>
                              </div>
                          </div>
                      </div>
                  </div>
                </div>
              {% endif %}
            {% endfor %}
          </div>
        
          <!-- Правая колонка с итогами -->
          <div class="cart-summary">
            <div class="summary-card">
              <div class="promo-code-section">
                <input type="text" class="promo-code-input" placeholder="Ввести промокод" />
              </div>
              
              <div class="summary-prices">
                <div class="summary-row">
                  <div><span data-cart-item-count></span> товара</div>
                  <div data-cart-total-price></div>
                </div>
                <div class="summary-row">
                  <div>Скидка:</div>
                  <div class="discount">TODO</div>
                </div>
                <div class="summary-row">
                  <div>Доставка:</div>
                  <div>Бесплатно</div>
                </div>
              </div>
              
              <div class="delivery-address">
                <a href="#" class="address-link">Выбрать адрес доставки</a>
              </div>
              
              <div class="checkout-section">
                <div class="total-row">
                  <span class="total-label">Итого:</span>
                  <div class="total-amount">
                    <span class="total-price" data-cart-full-total-price></span>
                    {% comment %} <span class="total-period">/ день</span> {% endcomment %}
                  </div>
                </div>
                
                <button class="checkout-btn">Перейти к оформлению</button>
                
                <div class="delivery-note-summary">
                  Ближайшая доставка: 19 марта с 6:00 до 10:00
                </div>
              </div>
            </div>
            
            <div class="additional-note-card">
              <p>N.B. Товары из полезного магазина доставляются в первый день доставки программы</p>
            </div>
          </div>
        </div>
        <input
          type="hidden"
          name="_method"
          value="put">
        <input
          type="hidden"
          name="make_order"
          value="">
        <input
          type="hidden"
          name="lang"
          value="{{ language.locale }}" />
      </form>
    {% else %}
      <div class="cart-items-container">
        <div class="cart-empty">
          <h1 class="cart-title">Корзина пуста</h1>
        </div>
      </div>
    {% endif %}
</div>

{% comment %}
{% include "system_bnpl-modal" %}

{% if widget_settings.page_header and widget_settings.page_header != '' %}
  <h1 class="heading">{{ widget_settings.page_header | editable }}</h1>
{% endif %}
{% if cart.items.size > 0 %}
  <form
    action="{{ cart_items }}"
    class="cart {% if cart.enable_coupon? %}with-coupon{% endif %}"
    method="post"
    data-cart-form
    data-reload-on-coupon="false"
    data-shop-title="{{ account.title }}"
    data-shop-host="{{ account.main_host }}"
    data-items-in-cart="{{- widget_messages.items_in_cart -}}"
    data-share-items="{{- widget_messages.shared_cart -}}"
    >
    <input
      type="text"
      name="shared-cart-link"
      class="shared-cart-link hidden" />
    <div class="cart__area-items">
      {% for item in cart.items %}
        <div
          class="cart-item {{ cart_class }}"
          data-product-id="{{ item.product.id }}"
          data-product-updated-at="{{ item.product.updated_at }}"
          data-item-id="{{ item.id }}"
          data-review-singular="{{ messages.review }}"
          data-review-singular-gen="{{ widget_messages.review_singular_gen }}"
          data-review-plural="{{ widget_messages.review_plural }}">
          <div class="item-image">
            <div class="img-ratio img-ratio_cover">
              <div class="img-ratio__inner">
                <img
                  title="{{ item.title | escape }}"
                  alt="{{ item.title | escape }}"
                  src="{{ item.variant.first_image.large_url }}"
                  class="item-image">
              </div>
            </div>
          </div>
          <a href="{{item.product.url | add_param: 'variant_id', item.variant.id }}" class="item-title">
            {{ item.product.title }}
            {% if item.variant.title != "" %}<br><span class="variant-title">({{ item.variant.title }})</span>
            {% endif %}
          </a>
          {% if account.reviews_enabled? and item.product.reviews_count > 0 %}
            <div class="item-rating">
              {% if item.product.rating %}
                <div class="rating">
                  {% for i in (1..5) %}
                    <span class="icon {% if item.product.rating >= i %}icon-star active{% else %}icon-star-o{% endif %}"></span>
                  {% endfor %}
                </div>
              {% endif %}
              <div class="rewiews">
                <span class="review-count">{{ item.product.reviews_count }}</span>
                <span class="review-text"></span></div>
            </div>
          {% endif %}
          <div class="item-price">
            <div>
              <span class="price" data-cart-item-price>
                {{ item.sale_price | money }}
              </span>/{{ item.unit }}
            </div>
            {% if item.variant.old_price > item.sale_price %}
              <span class="price-old">{{ item.variant.old_price | money }}</span>
            {% endif %}
          </div>
          <div class="item-counter ">
            <div class="counter" data-quantity>
              <button
                type="button"
                data-quantity-change="-1"
                class="counter-button button button_size-s is-count-down ">
                <span class="icon icon-minus"></span>
              </button>
              <input
                type="text"
                value="{{ item.quantity }}"
                name="cart[quantity][{{item.id}}]"
                class="counter-input form-control form-control_size-s" />
              <button
                type="button"
                data-quantity-change="1"
                class="counter-button button button_size-s is-count-up ">
                <span class="icon icon-plus"></span>
              </button>
            </div>
          </div>
          <div class="item-total" data-cart-item-total-price>
            {{ item.total_price | money }}
          </div>
          <div class="item-delete">
            <button
              class="button js-item-delete icon icon-times"
              type="submit"
              data-item-delete="{{ item.id }}"></button>
          </div>

          {% if item.accessory_lines.size > 0 %}
            {% assign total_accessories_price = 0 %}
            {% assign accessories_prices = item.accessory_lines | map: 'accessory_value_price' %}
            {% for price in accessories_prices %}
              {% assign total_accessories_price = total_accessories_price | plus: price %}
            {% endfor %}
            <div class="item-accessories" data-item-accessories>
              <div class="item-accessories__header">
                <button class="item-accessories__expander">
                  <span class="item-accessories__title">{{ messages.product_options }}</span>
                  <span class="icon icon-sort-asc hidden"></span>
                  <span class="icon icon-sort-desc"></span>
                </button>
                <span class="item-accessories__total-price">{{ total_accessories_price | money }}</span>
              </div>
              <div class="item-accessories__items is-hidden">
                {% for accessory in item.accessory_lines %}
                <div class="accessory-item">
                    <span class="accessory-item__name" data-item-accessory-value-id="{{ accessory.accessory_value_id }}">{{ accessory.accessory_value_name }}</span>
                    <span class="accessory-item__price">{{ accessory.accessory_value_price | money }}</span>
                </div>
              {% endfor %}
              </div>
            </div>
          {% endif %}
        </div>
      {% endfor %}
    </div>
    <div class="cart__area-controls">
      {% if cart.enable_coupon? %}
        <div class="cart__area-coupon">
          <div class="coupon-content">
            <div class="coupon-input">
              <input
                type="text"
                placeholder="{{ messages.coupon_placeholder }}"
                class="form-control form-control_size-m form-control_wide"
                name="cart[coupon]"
                value="{{ cart.coupon }}" />
              <button data-remove-coupon>
                <span class="icon icon-times"></span>
              </button>
            </div>
            <button
              type="submit"
              class="coupon-button button button-link_size-m"
              data-coupon-submit>{{ widget_messages.filter_submit_title }}</button>
          </div>
          <div class="coupon-notice" data-cart-discounts-error></div>
        </div>
      {% endif %}
      <div class="cart-controls">
        <div class="total-products">
          <div>{{ messages.products }} (<span data-cart-positions-count></span>)</div>
          <div
            data-cart-full-total-price></div>
        </div>
        <div class="discount" data-cart-discounts-ajax></div>
        <div class="total">
          <span class="total-description">{{ messages.total_caption }}:</span>
          <span class="total-amount" data-cart-total-price></span>
        </div>
        <div class="submit-block">
        <button
          type="submit"
          class="button button_size-l button_wide"
          data-cart-submit>{{ messages.checkout }}</button>
          {% if editor_mode? or widget_settings.shared-cart-enable == true  %}
                <button type="button" class="button button_size-l button_wide social-button js-copy-url button_second">
                  <span class="text">{{ widget_messages.share }}</span>
                    <svg width="25" height="24" viewBox="0 0 25 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path fill-rule="evenodd" clip-rule="evenodd" d="M11.9697 3.2196C12.2626 2.9268 12.7374 2.9268 13.0303 3.2196L16.9678 7.15607C17.2607 7.44892 17.2608 7.9238 16.9679 8.21673C16.675 8.50966 16.2002 8.50972 15.9072 8.21687L13.25 5.56032V14.25C13.25 14.6642 12.9142 15 12.5 15C12.0858 15 11.75 14.6642 11.75 14.25V5.56032L9.09276 8.21687C8.79983 8.50972 8.32496 8.50966 8.0321 8.21673C7.73925 7.9238 7.73931 7.44892 8.03224 7.15607L11.9697 3.2196ZM5 14.25C5 13.8358 4.66421 13.5 4.25 13.5C3.83579 13.5 3.5 13.8358 3.5 14.25V19.5C3.5 19.8978 3.65804 20.2794 3.93934 20.5607C4.22065 20.842 4.60218 21 5 21H20C20.3978 21 20.7794 20.842 21.0607 20.5607C21.342 20.2794 21.5 19.8978 21.5 19.5V14.25C21.5 13.8358 21.1642 13.5 20.75 13.5C20.3358 13.5 20 13.8358 20 14.25V19.5H5V14.25Z" fill="#1F7D63"/>
                  </svg>
                </button>
              {% endif %}
              </div>
        {% if sber_bnpl.payment_gateway_enabled? %}
          {% if sber_bnpl.show_at_cart == true %}
            {% include "system_bnpl-cart" %}
          {% endif %}
        {% endif %}
      </div>
    </div>
    <input
      type="hidden"
      name="_method"
      value="put">
    <input
      type="hidden"
      name="make_order"
      value="">
    <input
      type="hidden"
      name="lang"
      value="{{ language.locale }}" />
  </form>
  {% assign cart_empty_class = 'hidden' %}
{% endif %}
<div class="text-center js-cart-empty {{ cart_empty_class }}">
  {{ messages.cart_is_empty }}
</div>
{% endcomment %}
