<!-- Product Section - Универсальный модуль -->
<section class="product-section" id="productSection">
  <div class="product-details">
    <div class="product-header">
      <h1 class="product-title" id="program-title"></h1>
      <div class="menu-selector">
        <div class="menu-info">
          <p class="menu-description">Уникальное меню на <span id="program-duration"></span> дней:</p>
          <div class="day-navigation">
            <button class="nav-btn prev-btn">
              <img src="{{ 'arrow-1.svg' | asset_url }}" alt="Previous" />
            </button>
            <div class="days-container">
              <span class="day-item current-day"></span>
            </div>
            <button class="nav-btn next-btn">
              <img src="{{ 'arrow-1-1.svg' | asset_url }}" alt="Next" />
            </button>
          </div>
        </div>
        <div class="nutrition-info">
          <span class="nutrition-item">К 0</span>
          <span class="nutrition-item">Б 0</span>
          <span class="nutrition-item">Ж 0</span>
          <span class="nutrition-item">У 0</span>
        </div>
      </div>
      <div class="dishes-gallery">
        <!-- Блюда будут загружены динамически из соответствующих файлов данных -->
        <div class="loading-dishes"></div>
      </div>
    </div>
    <div class="product-description">
      <h2 class="description-title" id="program-description-title"></h2>
      <p class="description-text" id="program-description-text">

      </p>
    </div>
  </div>

  <!-- Settings Panel -->
  <aside class="settings-panel" id="settingsPanel">
    <!-- Все секции будут созданы динамически на основе конфигурации -->
    <!-- Order Summary будет добавлен динамически -->
  </aside>
</section>

<!-- Delivery Time Popup -->
<div class="quantity-popup" id="quantityPopup">
  <div class="popup-overlay"></div>
  <div class="popup-content">
    <div class="popup-left-section">
      <div class="popup-form">
        <div class="popup-header">
          <h3 class="popup-title">ВЫБЕРИТЕ УДОБНОЕ ВРЕМЯ ДОСТАВКИ</h3>
          <p class="popup-description">Пожалуйста, укажите желаемый временной слот для доставки. Мы постараемся привезти заказ в выбранное время</p>
        </div>
        
        <div class="popup-inputs">
          <div class="input-row">
            <div class="input-field">
              <input type="text" placeholder="Начало доставки" id="startDateInput" readonly />
              <div class="calendar-dropdown" id="startDateCalendar">
                <div class="calendar-header">
                  <button class="calendar-nav-btn prev-btn">
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path d="M10 12L6 8L10 4" stroke="#9D9D9D" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                  </button>
                  <div class="calendar-title">
                    <span class="calendar-month">Месяц</span>
                    <span class="calendar-year">2025</span>
                  </div>
                  <button class="calendar-nav-btn next-btn">
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path d="M6 4L10 8L6 12" stroke="#9D9D9D" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                  </button>
                </div>
                <div class="calendar-grid" id="startDateGrid">
                  <!-- Дни недели -->
                  <div class="calendar-day-header">Пн</div>
                  <div class="calendar-day-header">Вт</div>
                  <div class="calendar-day-header">Ср</div>
                  <div class="calendar-day-header">Чт</div>
                  <div class="calendar-day-header">Пт</div>
                  <div class="calendar-day-header">Сб</div>
                  <div class="calendar-day-header">Вс</div>
                  <!-- Дни месяца будут добавлены динамически -->
                </div>
              </div>
            </div>
            <div class="input-field">
              <input type="text" placeholder="Последний день доставки" id="endDateInput" readonly />
            </div>
          </div>
          <div class="input-row">
            <div class="input-field with-icon">
              <input type="text" placeholder="В какое время доставить?" id="deliveryTimeInput" readonly />
              <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M4 6L8 10L12 6" stroke="#9D9D9D" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
              <div class="delivery-time-dropdown" id="deliveryTimeDropdown">
                <div class="time-list" id="timeList">
                  <!-- Time slots будут добавлены динамически из конфигурации -->
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <div class="popup-total">
          <span class="total-label">Итого:</span>
          <span class="total-value" id="popupTotalValue">0 ₽</span>
        </div>
      </div>
      
      <div class="popup-footer">
        <button class="add-to-cart-popup-btn" id="addToCartPopupBtn">Добавить в корзину</button>
      </div>
    </div>
    
    <div class="popup-right-section">
      <div class="popup-image" id="popupImage">
        <div class="image-overlay">
          <h2 class="image-title" id="popupImageTitle">ПРОГРАММА</h2>
        </div>
      </div>
    </div>
    
    <button class="popup-close" id="popupClose">
      <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M12 4L4 12M4 4L12 12" stroke="#9D9D9D" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
    </button>
  </div>
</div>

<form action="{{ cart_url }}" method="post" data-product-id="{{ product.id }}" id="hte-product-form">
  <div class="product__sku">
    <span data-product-card-sku='{
        "skuLabel": "Артикул."
      }'
    ></span>
  </div>

  <span data-product-card-available='{
      "availableText": "Товар в наличии",
      "notAvailableText": "Нет в наличии"
    }'
  >
  </span>

  <div data-product-card-old-price></div>
  <div data-product-card-price></div>

  {% if product.show_variants? %}
    <select name="variant_id" data-product-variants='{"default": "option-radio"}'>
      {% for variant in product.variants %}
        <option value="{{ variant.id }}">{{ variant.title | escape }}</option>
      {% endfor %}
    </select>
  {% else %}
    <input type="hidden" name="variant_id" value="{{product.variants.first.id}}" >
  {% endif %}

  {% unless product.is_bundle %}
    {% if product.accessories.size > 0 %}
      <div class="product__area-accessories">
        <div class="label-accessories">{{ messages.options }}</div>
        <div data-product-accessories></div>
      </div>

      <template data-product-accessories-template>
        <div
          class="accessory-item"
          data-product-accessories-item
        >
          <div class="accessory-name">
            <strong>
              <span data-product-accessory-name></span>
            </strong>

            <span data-product-accessory-minmax-count='{
              "minCountMessage": "{{ messages.from }}",
              "maxCountMessage": "{{ messages.to }}"
            }'></span>
          </div>

          <div class="accessory-values" data-product-accessory-values></div>

          <div
            data-product-accessory-error='{
              "lessThenMinCount": "Выбрано меньше минимального количества",
              "moreThenMaxCount": "Выбрано больше максимального количества",
              "scrollEnabled": "true"
            }'
            class="accessory-item__error"
          ></div>
        </div>
      </template>

      <template data-product-accessory-values-template>
        <label
          class="accessory-values__item"
          data-product-accessory-values-item
          data-product-accessory-values-item-id
        >
          <span data-product-accessory-values-item-name></span> (+<span data-product-accessory-values-item-price></span>)
        </label>
      </template>
    {% endif %}
  {% endunless %}

  <div data-quantity data-min="1">
    <input type="text" name="quantity" value="1" />
    <span data-quantity-change="-1">-</span>
    <span data-quantity-change="1">+</span>
  </div>

  <div>
    <input type="text" name="delivery_dates" value="">
  </div>

  <div>
    <input type="text" name="delivery_dates_massive" value="">
  </div>

  <div>
    <input type="text" name="comment" value="">
  </div> 

  <button type="submit" id="addToCartBtn">
    Добавить в корзину
  </button>
</form>

<script>
    window.PROGRAM_CONFIG = {
      "programName": "ПЕРЕЗАГРУЗКА",
      "startDate": "2025-01-01",
      "deliverySchedule": "every-day",
      "basePrice": 0,
      "deliveryTimeSlots": [
        {
          "value": "06:00-07:00",
          "label": "06:00 — 07:00"
        },
        {
          "value": "07:00-08:00",
          "label": "07:00 — 08:00"
        },
        {
          "value": "08:00-09:00",
          "label": "08:00 — 09:00"
        },
        {
          "value": "09:00-10:00",
          "label": "09:00 — 10:00"
        }
      ],
      "description": {
        "title": "ДЛЯ ТЕХ, КТО ХОЧЕТ ПОЧУВСТВОВАТЬ СЕБЯ БОДРЕЕ, ЛЕГЧЕ И УВИДЕТЬ РЕЗУЛЬТАТ",
        "text": "Короткий курс для быстрого перезапуска организма. За 10 дней вы получите не только эффективное и безопасное снижение веса, но и восстановите энергию. Каждый приём пищи — сочетание цельных продуктов, не вызывающих скачков сахара. Рацион обеспечивает стабильный уровень глюкозы. Уникальность программы — в полном отсутствии десертов и смарт-комбинациях, которые позволяют достичь результатов мягко и без стресса."
      },
      "dataFiles": {
        "1300-classic": "data/perezagruzka/perezagruzka-1300-classic.json"
      },
      "allergens": {
        "enabled": false,
        "maxAllergens": 0,
        "allergenPrice": 0,
        "freeAllergenIds": [],
        "texts": {
          "allergenText": "Аллергены не исключаются"
        }
      },
      "calorieOptions": [
        {
          "value": "1300",
          "label": "1300",
          "unit": "ккал",
          "price": 5800
        }
      ],
      "dietTypes": [
        {
          "value": "classic",
          "label": "Классика",
          "price": 0
        }
      ]
    }

    window.PROGRAM_DISHES_DATA = {
        "1300-classic": {
            "programName": "ПЕРЕЗАГРУЗКА",
            "calorieOption": "1300",
            "dietType": "classic",
            "totalDays": 3,
            "mealOptions": [],
            "dishesByDay": {
                "day-1": {
                    "dishes": [
                        {
                            "id": 1,
                            "name": "Перезагрузка 1300 Классика - Лосось с киноа и овощами",
                            "image": "https://static.insales-cdn.com/files/1/1529/96421369/original/reload_1.jpg",
                            "nutrition": "580,48,22,28",
                            "isBreakfast": false,
                            "isSnack": false,
                            "isDinner": false,
                            "isSoup": false
                        },
                        {
                            "id": 2,
                            "name": "Омлет с авокадо и шпинатом",
                            "image": "https://static.insales-cdn.com/files/1/1545/96421385/original/reload_2.jpg",
                            "nutrition": "520,42,28,18",
                            "isBreakfast": false,
                            "isSnack": false,
                            "isDinner": false,
                            "isSoup": false
                        },
                        {
                            "id": 3,
                            "name": "Салат с креветками и авокадо",
                            "image": "https://static.insales-cdn.com/files/1/1537/96421377/original/reload_3.jpg",
                            "nutrition": "480,40,20,26",
                            "isBreakfast": false,
                            "isSnack": false,
                            "isDinner": false,
                            "isSoup": false
                        }
                    ]
                },
                "day-2": {
                    "dishes": [
                        {
                            "id": 4,
                            "name": "Индейка с брокколи и киноа",
                            "image": "https://static.insales-cdn.com/files/1/2945/90614657/original/dishes-5.jpg",
                            "nutrition": "560,52,18,26",
                            "isBreakfast": false,
                            "isSnack": false,
                            "isDinner": false,
                            "isSoup": false
                        },
                        {
                            "id": 5,
                            "name": "Греческий йогурт с ягодами и орехами",
                            "image": "https://static.insales-cdn.com/files/1/2465/90614177/original/dishes-3.jpg",
                            "nutrition": "460,38,22,30",
                            "isBreakfast": false,
                            "isSnack": false,
                            "isDinner": false,
                            "isSoup": false
                        },
                        {
                            "id": 6,
                            "name": "Протеиновый коктейль с бананом",
                            "image": "https://static.insales-cdn.com/files/1/2809/90614521/original/dishes-4.jpg",
                            "nutrition": "420,38,16,32",
                            "isBreakfast": false,
                            "isSnack": false,
                            "isDinner": false,
                            "isSoup": false
                        }
                    ]
                },
                "day-3": {
                    "dishes": [
                        {
                            "id": 7,
                            "name": "Куриная грудка с овощами",
                            "image": "https://static.insales-cdn.com/files/1/2513/90614225/original/dishes-1.jpg",
                            "nutrition": "540,50,20,24",
                            "isBreakfast": false,
                            "isSnack": false,
                            "isDinner": false,
                            "isSoup": false
                        },
                        {
                            "id": 8,
                            "name": "Творожный пудинг с медом",
                            "image": "https://static.insales-cdn.com/files/1/2937/90614649/original/dishes-6.jpg",
                            "nutrition": "320,30,16,22",
                            "isBreakfast": false,
                            "isSnack": false,
                            "isDinner": false,
                            "isSoup": false
                        },
                        {
                            "id": 9,
                            "name": "Ореховая смесь с сухофруктами",
                            "image": "https://static.insales-cdn.com/files/1/2809/90614521/original/dishes-4.jpg",
                            "nutrition": "280,26,14,18",
                            "isBreakfast": false,
                            "isSnack": false,
                            "isDinner": false,
                            "isSoup": false
                        }
                    ]
                }
            }
        }
    };

    window.ALLERGENS_CONFIG = {

    };

    window.currentTime = new Date(2025, 8, 1, 0, 0, 0);
</script>    

<!-- Основные скрипты -->
<script src="{{ '02-allergens-config.js' | asset_url }}"></script>
<script src="{{ '02-allergens.js' | asset_url }}" defer></script>
<script src="{{ 'date-availability.js' | asset_url }}"></script>
<script src="{{ '02-dishes-gallery.js' | asset_url }}" defer></script>
<script src="{{ '04-products-slider.js' | asset_url }}" defer></script>
<script src="{{ 'quantity-popup.js' | asset_url }}" defer></script>
<script src="{{ 'date-picker-calendar.js' | asset_url }}" defer></script>

<!-- Универсальная система Product Section -->
<script src="{{ 'product-section-config.js' | asset_url }}"></script>
<script src="{{ 'product-section-date-manager.js' | asset_url }}"></script>
<script src="{{ 'product-section-dishes-manager.js' | asset_url }}"></script>
<script src="{{ 'product-section-price-manager.js' | asset_url }}"></script>
<script src="{{ 'product-section-settings-builder.js' | asset_url }}"></script>
<script src="{{ 'product-section-ui-manager.js' | asset_url }}"></script>
<script src="{{ 'product-section-main.js' | asset_url }}"></script>
<script src="{{ 'product-section-init.js' | asset_url }}"></script>

<script src="{{ 'calendar.js' | asset_url }}" defer></script>

<script>
      // Загружаем компоненты при загрузке DOM
      document.addEventListener('DOMContentLoaded', async () => {
        try {
          // Ждем готовности конфигурации программы
        //   await window.waitForProgramConfig();
          
          // Инициализируем универсальную систему после загрузки компонентов
          if (window.initializeProductSection) {
            await window.initializeProductSection();
          } else {
            console.error('❌ Функция initializeProductSection не найдена');
          }
          
          // Инициализируем попап выбора времени доставки ПОСЛЕ загрузки всех компонентов
          if (window.initQuantityPopup) {
            window.initQuantityPopup();
          } else {
            console.error('❌ Функция initQuantityPopup не найдена');
          }
          
        } catch (error) {
          console.error('❌ Ошибка загрузки страницы:', error);
        }
      });
</script>